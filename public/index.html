<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matching Exercise Demo</title>
    <style>
        body {
            margin: 0;                    
        }
    </style>
</head>
<body>


    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
    <script type="module">
        import {
            ManualContract,
            MatchingContract,
            MatchingWheelsContract
        } from './dist/index.js';

        // Get DOM elements

        let currentHandler;
     

        function createExerciseBlock(renderer, data) {
        
            const block = document.createElement("section");
            document.documentElement.append(block);

            const r = renderer(
                block,
                data,
                {
                    shuffle: true,
                    allowRetry: true,
                    resultHandler: () => {
                        confetti({
                            particleCount: 100,
                            spread: 70,
                            origin: { y: 0.6 },
                        });
                    }
                }
            );

    
            currentHandler = r; 
        }

        function getContractInfo(contract) {
            
            const code = contract.grammarExample[0];          

            const parser = contract.implementation.parser;        
            
            const validator = contract.implementation.validator; 
            const renderer = contract.implementation.renderer;                

            const parsed = parser(code);

            createExerciseBlock(renderer, parsed.content);
        }

        function removeStyleTags() {
            const styleTags = document.getElementsByTagName('style');

            // Loop in reverse to avoid issues with live NodeList updates
            for (let i = styleTags.length - 1; i >= 0; i--) {
                const styleTag = styleTags[i];
                styleTag.parentNode.removeChild(styleTag);
            }
        }


        document.documentElement.addEventListener('keydown', e => {
            if (e.key === 'q') {
                if (currentHandler) currentHandler.destroy();
                removeStyleTags();
                getContractInfo(MatchingContract);
            }

            if (e.key === 'w') {
                if (currentHandler) currentHandler.destroy();
                removeStyleTags();
                getContractInfo(ManualContract);
            }

            if (e.key === 'e') {
                if (currentHandler) currentHandler.destroy();
                removeStyleTags();
                getContractInfo(MatchingWheelsContract);
            }
        });

    </script>
</body>
</html>
