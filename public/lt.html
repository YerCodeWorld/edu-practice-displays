<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Letter Picker â€“ Carousel</title>
  <style>
    :root{
      --accent-color:#2f855a; 
      --border-color:#22543d;
      --bg-color:#f0fff4;
      --text-color:#1a202c; 
      --shadow:rgba(0,0,0,.2);
    }
    *{box-sizing:border-box}
    
    body{  
      margin:0; 
      background-image:url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSdGMmkyax8_nzanbfOGadHC03Nu_DqzJAQxQ&s'); padding:24px;
      min-height: 100vh;
    }
    
    main {
      background-color: rgba(255, 255, 255, 0.8);      
      display:grid; 
      place-items:center;
      font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text-color);
      min-height: 90vh;
    }
    .card{
      width:min(860px,100%); background:var(--bg-color); border:1px solid #e9ecef;
      border-radius:16px; box-shadow:0 10px 30px var(--shadow); padding:24px;
    }
    .top{
      display:block;             
      place-items: center;
      gap:12px;
    }    
    .top label {
      font-weight: 600;
      align-content: center;
      border: 2px dashed var(--accent-color); 
      padding: 4px; 
      transform: rotate(-5deg); 
    }
    .instruction{ font-weight:600; font-size:2.05rem; }
    .progress{ opacity:.7; font-size:1.95rem; }
    .word {
      margin-top:10%; 
      margin-bottom:10%; 
      
      display:flex; 
      gap:.6rem; 
      flex-wrap:wrap; 
      align-items:center;
      justify-content:center;
    }
    .letter{
      min-width:2ch; 
      text-align:center; 
      font-weight:800; 
      letter-spacing:.02em;
      font-size:1.8rem; 
      color: var(--text-color);
      border-bottom: 2px solid var(--text-color);
    }
    letter-picker{ --accent-color:#e67e22; }
    /* Visual feedback using the component's ::part(display) */
    letter-picker[data-state="correct"]::part(display){ border-color:#2ecc71 !important; box-shadow:0 0 0 2px rgba(46,204,113,.25); }
    letter-picker[data-state="wrong"]::part(display){ border-color:#e74c3c !important; box-shadow:0 0 0 2px rgba(231,76,60,.2); }
    .controls{
      margin-top:20px; display:flex; gap:10px; align-items:center; justify-content:center;
    }
    .btn{
      border:1px solid #e1e5ea; background:#fff; padding:10px 14px; border-radius:10px;
      cursor:pointer; font-weight:600;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed }
    @media (max-width:520px){
      .letter{ font-size:1.4rem }
      .top{ flex-direction:column; gap:6px }
    }
  </style>
</head>
<body>
  <main>
    <div class="card">
      <div class="top">      
        <div class="progress" id="progress">1 / 1</div>
        <div style="display: flex; gap: 10px;">
          <label>Hint </label>
          <div class="instruction" id="instruction">Instruction</div>      
        </div>
      </div>

      <div class="word" id="word"></div>

      <div class="controls">
        <button class="btn" id="prev">â—€ Prev</button>
        <button class="btn" id="reveal">Check</button>
        <button class="btn" id="next">Next â–¶</button>
      </div>
    </div>
  </main>
  <!-- Carousel logic -->
  <script type="module">

    import { LetterPicker } from './dist/index.js';

    customElements.define("letter-picker", LetterPicker);
    
    // Data: blanks are 1-based positions to replace with <letter-picker>
    const data = [
      { instruction: 'To eat with friends and family', content: 'Restaurant', blanks: [2, 3, 6, 7] },
      { instruction: 'Teens go to study here',         content: 'school',     blanks: [1, 2, 5]     },
      { instruction: 'Doing exercise',                  content: 'GYM',        blanks: [1, 2]        },
      { instruction: 'You go shopping here',            content: 'Supermarket',blanks: [3, 5, 6, 7]  }
    ];

    const $word = document.getElementById('word');
    const $instruction = document.getElementById('instruction');
    const $progress = document.getElementById('progress');
    const $prev = document.getElementById('prev');
    const $next = document.getElementById('next');
    const $reveal = document.getElementById('reveal');   
    $reveal.disabled = true;   

    let state = {};    
    let checked = [];    

    // let correct = 0;    

    let idx = 0;

    await customElements.whenDefined('letter-picker');

    function renderSlide(i) {                  
    
      const item = data[i];
      const answer = [...item.content];          
      const blanks = new Set(item.blanks || []); // 1-based indices      

      $instruction.textContent = item.instruction;
      $progress.innerHTML = `${i+1} / <strong style="color: var(--accent-color)">${data.length}</strong>`;
      $word.innerHTML = '';

      for(let pos = 1; pos <= answer.length; pos++) {
      
        const ch = answer[pos-1];

        if(blanks.has(pos)) {
          const lp = document.createElement('letter-picker');          
          lp.setAttribute('mode','box');
          lp.setAttribute('placeholder','ðŸ’¬');
          lp.dataset.pos = String(pos);
          lp.id = `lp-${i}-${pos}`;

          if (Object.keys(state).includes(lp.id)) {            
            lp.setAttribute('value', state[lp.id]);            
          }

          lp.addEventListener('change', () => updateState(lp.id));

          $word.appendChild(lp);
        } else {
          const div = document.createElement('div');
          div.className = 'letter';
          div.textContent = ch;
          $word.appendChild(div);
        }
        
      }

      // this keeps the correct/wrong state updated
      if (checked.includes(i)) {        
        checkSlide(idx)
      };      

      $prev.disabled = (i === 0);
      $next.disabled = (i === data.length - 1);
    }

    // keep the check functionality only after all blanks have been completed 
    function checkCompleted(i) {
    
      const item = data[i];
      const word = item.content; 
      const blanks = new Set(item.blanks || []);        

      let isCompleted = true;

      for (let pos of blanks){      
      
        const lp = document.getElementById(`lp-${i}-${pos}`);
        const selected = lp.getAttribute('value');
        
        if (!selected) isCompleted = false;                
        
      }

      $reveal.disabled = !isCompleted;
      
    }

    function updateState(id) {
      const el = document.getElementById(id);
      const val = el.getAttribute('value');
      if (!val) return;

      state[id] = val;       

      checkCompleted(idx);
    }

    function checkSlide(i){
    
      const item = data[i];
      const word = item.content; 
      const blanks = new Set(item.blanks || []);      
        
      for (let pos of blanks){      
      
        const lp = document.getElementById(`lp-${i}-${pos}`);
        const selected = lp.getAttribute('value');
        if (!selected) continue;        
        
        if (selected.toLowerCase().trim() === word[pos-1].toLowerCase()) {          
          lp.setAttribute('data-state', 'correct');          
        } else {
          lp.setAttribute('data-state', 'wrong');
        }        

        lp.disabled = 'true';
      }      
    
      checked.push(i);
            
    }

    // nav 
    $prev.addEventListener('click', () => { idx = Math.max(0, idx-1); renderSlide(idx); });
    $next.addEventListener('click', () => { idx = Math.min(data.length-1, idx+1); renderSlide(idx); });
    $reveal.addEventListener('click', () => checkSlide(idx));
    
    window.addEventListener('keydown', (e) => {
      if(e.key === 'ArrowRight'){ $next.click(); }
      else if(e.key === 'ArrowLeft'){ $prev.click(); }
    });

    renderSlide(idx);
  </script>
</body>
</html>

